<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Bitcask | Home</title>
<link rel=stylesheet href=/css/root.min.85dc16f61334daf3d0f78be20f64b1090ef27354e9b420e92c7a54c7b173917e.css integrity="sha256-hdwW9hM02vPQ94viD2SxCQ7yc1TptCDpLHpUx7FzkX4=" crossorigin=anonymous><link rel=stylesheet href=/css/bundle.min.10caa6e13ecab99b130dea37bdc9287c5929fd3e6572a84e856b4b069704026c.css integrity="sha256-EMqm4T7KuZsTDeo3vckofFkp/T5lcqhOhWtLBpcEAmw=" crossorigin=anonymous><script src=/js/bundle.995e4ec99401021e081ec256bee66154ef7f4e5136809432513b2e6d014b4b1d.js integrity="sha256-mV5OyZQBAh4IHsJWvuZhVO9/TlE2gJQyUTsubQFLSx0=" crossorigin=anonymous></script><script defer src=/js/search/flexsearch.compact.64594b125f7b78bdf4fa8316955922bbebb1cd6baef3f16654bfca20309f18f8.js integrity="sha256-ZFlLEl97eL30+oMWlVkiu+uxzWuu8/FmVL/KIDCfGPg="></script><script defer src=/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js integrity="sha256-HZgPhN8R8+t8jF8X9UHUmgYRYI3xed10+n8GIl61as4="></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet></head><body class=notransition><div id=container><header id=main-header><div role=navigation aria-label=Main><div class=nav-left><a href=https://example.org/ style=color:inherit>Home</a></div><div class=nav-right><div id=nav-dropdown-menu class=hidden href=#><div class=nav-item><a aria-current=true class=ancestor href=/posts/>文章</a></div><div class=nav-item><a href=/features/>归档</a></div><div class=nav-item><a href=/about/>关于</a></div></div><a id=nav-dropdown-button href=#><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4 6H20M4 12H20M4 18H20" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></a><div id=nav-menu><div class=nav-item><a aria-current=true class=ancestor href=/posts/>文章</a></div><div class=nav-item><a href=/features/>归档</a></div><div class=nav-item><a href=/about/>关于</a></div></div><a id=theme-switcher href=#><svg class="light-icon" viewBox="0 0 24 24" fill="none"><path d="M12 3V4m0 16v1M4 12H3M6.31412 6.31412 5.5 5.5m12.1859.81412L18.5 5.5M6.31412 17.69 5.5 18.5001M17.6859 17.69 18.5 18.5001M21 12H20m-4 0c0 2.2091-1.7909 4-4 4-2.20914.0-4-1.7909-4-4 0-2.20914 1.79086-4 4-4 2.2091.0 4 1.79086 4 4z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="dark-icon" viewBox="0 0 24 24" fill="none"><path d="M3.32031 11.6835c0 4.9706 4.02944 9 8.99999 9 3.7872.0 7.028-2.3392 8.3565-5.6515C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834c-4.9706.0-8.99999-4.0294-8.99999-8.99998C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996 5.65605 4.66028 3.32031 7.89912 3.32031 11.6835z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></a></div></div></header><div class="flex grow"><div id=main-pane><main id=main-content><div class=single-header><ol class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://example.org/><span itemprop=name>Home</span>
</a><meta itemprop=position content='1'></li><span>»</span><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://example.org/posts/><span itemprop=name>Posts</span>
</a><meta itemprop=position content='2'></li><span>»</span></ol><h1>Bitcask</h1><time datetime=2025-04-05T15:07:38+08:00>2025-04-05</time><div class=term-container><div class=tag><a href=https://example.org/tags/bitcask/>#bitcask</a></div><div class=tag><a href=https://example.org/tags/go/>#go</a></div></ol></div><section class=page-section><h1 id=bitcask>Bitcask</h1><p>Bitcask是一个高性能的键值存储系统，设计之初的目的是提供高写入吞吐量和高效读取性能。采用了日志化结构哈希表(Log-Structured Hash Table)，核心是写前日志(WAL)、内存哈希表和定期merge。具体细节均在官方的设计论文 <a href=https://riak.com/assets/bitcask-intro.pdf>Bitcask Design Paper</a> 中可以查看。</p><blockquote><p>官方论文中提到的bitcask应该具备的特性</p><ul><li>low latency per item read or written</li><li>high throughput, especially when writing an incoming stream of random items</li><li>ability to handle datasets much larger than RAM w/o degradation</li><li>crash friendliness, both in terms of fast recovery and not losing data</li><li>ease of backup and restore</li><li>a relatively simple, understandable (and thus supportable) code structure and data format</li><li>predictable behavior under heavy access load or large volume</li><li>a license that allowed for easy default use in Riak</li></ul></blockquote><p>目前已经有优秀的开源实现：</p><ul><li><a href=https://github.com/prologic/bitcask>prologic/bitcask</a> </li><li><a href=https://github.com/ahmeducf/bitcask>ahmeducf/bitcask</a></li><li><a href=https://github.com/rosedblabs/mini-bitcask.git>rosedblabs/mini-bitcask</a></li></ul><h2 id=bitcask-核心>Bitcask 核心</h2><ul><li>目录结构(bitcask)：作为一个目录，存储数据文件，仅允许一个进程同时写入</li><li>数据文件(datafile)：<ul><li>activefile: 当前用于写入的文件，达到阈值（1GB）时关闭，变成仅读文件</li><li>readonlyfile: 仅读文件，存储旧数据条目</li><li>dataentry: 写入数据文件的数据条目 => { crc | tstamp | key_sz | value_sz | key | value }</li></ul></li><li>内存结构(keydir): 映射键值到数据文件中的位置，每次写入时原子更新<ul><li>index: [key] -> { file_id | value_sz | value_pos | tstamp }</li></ul></li><li>合并(merge): 定期或者主动触发合并操作，遍历不可变文件，创建新的包含最新现有键的数据文件，同时生成提示文件(hint)</li><li>提示文件(hint): 包含数据文件中值的位置和大小信息，即保存keydir，加速启动流程</li><li>恢复崩溃(recover): 由于数据文件的不可变且作为提交日志，恢复简单，扫描提示文件进行恢复</li></ul><p>在bitcask论文中提到，允许处理比内存大得多的数据集，且不显著降低性能，是因为其采用了将键和元数据存储在内存中，而将数据值存储在磁盘上，通过键值分离的设计，使其能够处理比内存大得多的数据集。但是因此bitcask将所有的键存储在内存中，这可能在键数量极多的时候成为瓶颈。</p></section></main><footer id=main-footer><div class=footer><a href=#>回到顶部 ↑</a><div class=footer-copyright><div>© 2025 Chen-Hang</div><div>powered by <a href=https://github.com/math-queiroz/rusty-typewriter target=_blank>Rusty Typewriter</a> theme for <a href=https://gohugo.io/ target=_blank>Hugo</a></div></div></div></footer></div><aside id=side-pane class=side-sticky><div class=side-details><span>134 字数</span>
<span>2 - 2 阅读时间</span><div class=side-details-taxonomy><small>topics:
<span class=details-taxonomy><a href=https://example.org/topics/database>database</a></span></small></div></div><h3>目录</h3><nav id=TableOfContents><ul><li><a href=#bitcask-核心>Bitcask 核心</a></li></ul></nav></aside></div></div></body></html>