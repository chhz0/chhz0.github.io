<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Redis - Datatypes | ch.hugo</title>
<link rel=icon href=favicon.svg sizes=any type=image/svg+xml><meta property="og:url" content="https://chhz0.github.io/notes/database/redis/datatypes/"><meta property="og:site_name" content="ch.hugo"><meta property="og:title" content="Redis - Datatypes"><meta property="og:description" content="Redis 数据类型
Redis是一个数据结构服务，核心是提供一组原生的数据结构帮助服务应用解决各种问题，从缓存到队列到事件处理，都有适用的数据结构.
其核心数据结构有：
String: 字符串，是Redis中最基本的数据结构. List: 列表，按照插入顺序排序的字符串列表. Sets: 无序集合，是唯一字符串的无序集合. Hash: 哈希表，是字段-值集合的记录类型. ZSet: 有序集合，是唯一字符串的有序集合. Stream: 流，其作用类似于仅追加的日志，有助于按事件发生的顺序记录事件. BitMap: 位图，允许对字符串执行按位运算. Bitfield: 位域，可以有效将多个计数器编码位字符串. Geospatial: 地理空间，用于存储和查询地理空间数据. 扩展数据结构：
Json: 提供与流行的 JSON 文本文件格式匹配的结构化分层数组和键值对象. Probabilistic data types: 允许以近似但高效的方式收集和计算统计数据. Time series: 允许存储和查询带时间戳的数据点. 对于Redis详细的数据结构，可以参考Redis/data-types.
Redis Object 结构 Redis是kv存储，key和value在Redis中被抽象成对于(Object)，key只能是String对象，value支持丰富的对象类型，即上述的Redis数据结构.
RedisObject的结构:
#define LRU_BITS 24 typedef struct reidsObject { unsigned type:4; unsigned encoding:4; unsigned lru:LRU_BITS; /* LRU time or * lFU data */ int refcount; void *ptr; } robj; type: RedisObject的类型，如String、List、Hash等，对应上述数据结构. encoding: RedisObject的编码，表示了哪种底层编码. lru: 记录RedisObject被访问的时间，用于LRU算法. refcount: RedisObject的引用计数，表示了RedisObject被引用的次数，即有多少指针指向该对象 ptr: RedisObject的指针，指向RedisObject对应的数据结构. RedisObject和不同的数据结构及其编码的关系图:"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Redis - Datatypes"><meta name=twitter:description content="Redis 数据类型
Redis是一个数据结构服务，核心是提供一组原生的数据结构帮助服务应用解决各种问题，从缓存到队列到事件处理，都有适用的数据结构.
其核心数据结构有：
String: 字符串，是Redis中最基本的数据结构. List: 列表，按照插入顺序排序的字符串列表. Sets: 无序集合，是唯一字符串的无序集合. Hash: 哈希表，是字段-值集合的记录类型. ZSet: 有序集合，是唯一字符串的有序集合. Stream: 流，其作用类似于仅追加的日志，有助于按事件发生的顺序记录事件. BitMap: 位图，允许对字符串执行按位运算. Bitfield: 位域，可以有效将多个计数器编码位字符串. Geospatial: 地理空间，用于存储和查询地理空间数据. 扩展数据结构：
Json: 提供与流行的 JSON 文本文件格式匹配的结构化分层数组和键值对象. Probabilistic data types: 允许以近似但高效的方式收集和计算统计数据. Time series: 允许存储和查询带时间戳的数据点. 对于Redis详细的数据结构，可以参考Redis/data-types.
Redis Object 结构 Redis是kv存储，key和value在Redis中被抽象成对于(Object)，key只能是String对象，value支持丰富的对象类型，即上述的Redis数据结构.
RedisObject的结构:
#define LRU_BITS 24 typedef struct reidsObject { unsigned type:4; unsigned encoding:4; unsigned lru:LRU_BITS; /* LRU time or * lFU data */ int refcount; void *ptr; } robj; type: RedisObject的类型，如String、List、Hash等，对应上述数据结构. encoding: RedisObject的编码，表示了哪种底层编码. lru: 记录RedisObject被访问的时间，用于LRU算法. refcount: RedisObject的引用计数，表示了RedisObject被引用的次数，即有多少指针指向该对象 ptr: RedisObject的指针，指向RedisObject对应的数据结构. RedisObject和不同的数据结构及其编码的关系图:"><link rel=stylesheet href=/css/components.min.9d886688d3ae94cecf1b057e706bf74497fcd5cea352d433c34cda3b9425a8d4.css integrity="sha256-nYhmiNOulM7PGwV+cGv3RJf81c6jUtQzw0zaO5QlqNQ=" crossorigin=anonymous><link rel=stylesheet href=/css/main.min.17813e97a146cc70fc6064666a89082f1ef2f6213c7d3fade88402a86cf8aa3c.css integrity="sha256-F4E+l6FGzHD8YGRmaokILx7y9iE8fT+t6IQCqGz4qjw=" crossorigin=anonymous><link rel=stylesheet href=/css/root.min.1677bc99f2421f7cb9fc1d00b09addcc951fd9d4c785e22b20ed55c0602786fc.css integrity="sha256-Fne8mfJCH3y5/B0AsJrdzJUf2dTHheIrIO1VwGAnhvw=" crossorigin=anonymous><link rel=stylesheet href=/css/search.min.cb1ed1dad3ee872e229e9f1fc681bdbd20d923389f1fa6aaf89f9aee93af4fbf.css integrity="sha256-yx7R2tPuhy4inp8fxoG9vSDZIzifH6aq+J+a7pOvT78=" crossorigin=anonymous><link rel=stylesheet href=/css/bundle.min.4878d16c866148ae8cfd6f4f44052d25f2548b24ab4a9bc857279dc6d06df2b5.css integrity="sha256-SHjRbIZhSK6M/W9PRAUtJfJUiySrSpvIVyedxtBt8rU=" crossorigin=anonymous><script src=/js/bundle.995e4ec99401021e081ec256bee66154ef7f4e5136809432513b2e6d014b4b1d.js integrity="sha256-mV5OyZQBAh4IHsJWvuZhVO9/TlE2gJQyUTsubQFLSx0=" crossorigin=anonymous></script><script defer src=/js/search/flexsearch.compact.64594b125f7b78bdf4fa8316955922bbebb1cd6baef3f16654bfca20309f18f8.js integrity="sha256-ZFlLEl97eL30+oMWlVkiu+uxzWuu8/FmVL/KIDCfGPg="></script><script defer src=/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js integrity="sha256-HZgPhN8R8+t8jF8X9UHUmgYRYI3xed10+n8GIl61as4="></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet></head><body class=notransition><div id=container><header id=main-header><div role=navigation aria-label=Main><div class=nav-left><a href=https://chhz0.github.io/ style=color:inherit>ch.hugo</a></div><div class=nav-right><div style=position:absolute;width:0;height:0><div id=nav-dropdown-menu class=hidden href=#><div class=nav-item><a href=/blogs/>博客</a></div><div class=nav-item><a aria-current=true class=ancestor href=/notes/>笔记</a></div><div class=nav-item><a href=/about/>关于</a></div></div></div><a id=nav-dropdown-button href=#><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4 6H20M4 12H20M4 18H20" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></a><div id=nav-menu><div class=nav-item><a href=/blogs/>博客</a></div><div class=nav-item><a aria-current=true class=ancestor href=/notes/>笔记</a></div><div class=nav-item><a href=/about/>关于</a></div></div><a id=theme-switcher href=#><svg class="light-icon" viewBox="0 0 24 24" fill="none"><path d="M12 3V4m0 16v1M4 12H3M6.31412 6.31412 5.5 5.5m12.1859.81412L18.5 5.5M6.31412 17.69 5.5 18.5001M17.6859 17.69 18.5 18.5001M21 12H20m-4 0c0 2.2091-1.7909 4-4 4-2.20914.0-4-1.7909-4-4 0-2.20914 1.79086-4 4-4 2.2091.0 4 1.79086 4 4z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
<svg class="dark-icon" viewBox="0 0 24 24" fill="none"><path d="M3.32031 11.6835c0 4.9706 4.02944 9 8.99999 9 3.7872.0 7.028-2.3392 8.3565-5.6515C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834c-4.9706.0-8.99999-4.0294-8.99999-8.99998C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996 5.65605 4.66028 3.32031 7.89912 3.32031 11.6835z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
</a>|
<a id=theme-switcher href=https://github.com/chhz0 aria-label=GitHub><svg class="light-icon" width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#fff"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg><svg class="dark-icon" width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></div></div></header><div class="flex grow"><div id=main-pane><main id=main-content><ol class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://chhz0.github.io/><span itemprop=name>Home</span>
</a><meta itemprop=position content='1'></li><span>&nbsp»&nbsp</span><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://chhz0.github.io/notes/><span itemprop=name>Notes</span>
</a><meta itemprop=position content='2'></li><span>&nbsp»&nbsp</span><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://chhz0.github.io/notes/database/><span itemprop=name>Database</span>
</a><meta itemprop=position content='3'></li><span>&nbsp»&nbsp</span><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://chhz0.github.io/notes/database/redis/><span itemprop=name>Redis</span>
</a><meta itemprop=position content='4'></li><span>&nbsp»&nbsp</span></ol><h1>Redis - Datatypes</h1><blockquote><p>Redis 数据类型</p></blockquote><p>Redis是一个数据结构服务，核心是提供一组原生的数据结构帮助服务应用解决各种问题，从缓存到队列到事件处理，都有适用的数据结构.</p><p>其核心数据结构有：</p><ul><li><code>String</code>: 字符串，是Redis中最基本的数据结构.</li><li><code>List</code>: 列表，按照插入顺序排序的字符串列表.</li><li><code>Sets</code>: 无序集合，是唯一字符串的无序集合.</li><li><code>Hash</code>: 哈希表，是字段-值集合的记录类型.</li><li><code>ZSet</code>: 有序集合，是唯一字符串的有序集合.</li><li><code>Stream</code>: 流，其作用类似于仅追加的日志，有助于按事件发生的顺序记录事件.</li><li><code>BitMap</code>: 位图，允许对字符串执行按位运算.</li><li><code>Bitfield</code>: 位域，可以有效将多个计数器编码位字符串.</li><li><code>Geospatial</code>: 地理空间，用于存储和查询地理空间数据.</li></ul><p>扩展数据结构：</p><ul><li><code>Json</code>: 提供与流行的 JSON 文本文件格式匹配的结构化分层数组和键值对象.</li><li><code>Probabilistic data types</code>: 允许以近似但高效的方式收集和计算统计数据.</li><li><code>Time series</code>: 允许存储和查询带时间戳的数据点.</li></ul><p>对于Redis详细的数据结构，可以参考<a href=https://redis.io/docs/latest/develop/data-types/>Redis/data-types</a>.</p><h2 id=redis-object-结构>Redis Object 结构</h2><p>Redis是kv存储，key和value在Redis中被抽象成对于(Object)，key只能是<strong>String</strong>对象，value支持丰富的对象类型，即上述的Redis数据结构.</p><p>RedisObject的结构:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#define LRU_BITS 24
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> reidsObject {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> type:<span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> encoding:<span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> lru:LRU_BITS; <span style=color:#75715e>/* LRU time or
</span></span></span><span style=display:flex><span><span style=color:#75715e>                            * lFU data */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> refcount;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>ptr;
</span></span><span style=display:flex><span>} robj;
</span></span></code></pre></div><ul><li><code>type</code>: RedisObject的类型，如String、List、Hash等，对应上述数据结构.</li><li><code>encoding</code>: RedisObject的编码，表示了哪种底层编码.</li><li><code>lru</code>: 记录RedisObject被访问的时间，用于LRU算法.</li><li><code>refcount</code>: RedisObject的引用计数，表示了RedisObject被引用的次数，即有多少指针指向该对象</li><li><code>ptr</code>: RedisObject的指针，指向RedisObject对应的数据结构.</li></ul><p>RedisObject和不同的数据结构及其编码的关系图:</p><p><img src=/redis/redis-object-not.drawio.svg alt=redisObject-dependence></p><p>对于Redis在不同场景下使用不同的数据结构，数据结构又有不同的编码，其一般会使用如下规则：</p><ol><li><strong>当数据量较少时</strong>，尽量使用紧凑结构的编码方式，以节省内存空间，而且因为数据量较少，在性能上不会有太大的影响.</li><li><strong>当数据量较大时</strong>，将以空间换时间的方式，使用高效的数据编码，以提高性能.</li></ol><h2 id=redis-object-过期时间>Redis Object 过期时间</h2><p>Redis的过期时间给一个Key，指定一个时间，当到达这个时间时，Redis会自动删除这个Key.</p><p>设置过期时间的目的是可以有效地节省内存，而且在某些场景里，过期时间可以用于实现一些功能，如缓存、限流等.</p><h3 id=过期时间的设置>过期时间的设置</h3><p>通过以下方法可以设置过期时间:</p><ul><li>SET key value EX seconds；</li><li>SET key value PX milliseconds；设置毫秒</li><li>TTL key；查看还有多少时间过期</li></ul><p>在设置过期时间后，会有专门的字典记录key和过期时间.</p><h3 id=过期键清除策略>过期键清除策略</h3><p>过期之后的键实际上不是立即删除的，一般过期键清除策略有三种：</p><ol><li>定时删除</li><li>定期删除</li><li>惰性删除</li></ol><ul><li><p><code>定时删除</code>
是在设置键的过期时间的时候，创建一个定时器，让定时器在键过期时间立即执行对键删除操作，定时删除对内存友好，但是对CPU不友好，如果某个时间段比较多的Key过期，可能会影响命令处理性能</p></li><li><p><code>惰性删除</code>
是指使用的时候，发现key过期了，此时再进行删除，这个策略的思路是对应用而言，只要不访问，过期不过期业务都无所谓，但是这样的代价是如果某些key一直不访问，那些本该过期的key变成了常驻的key。这种策略对CPU最友好，但是对内存不太友好</p></li><li><p><code>定期删除</code>
每过一段时间，程序就对数据库进行一次检查，每次删除一部分过期键，这属于一种渐进式兜底策略</p><ul><li>定期删除的频率：决定于Redis周期任务的执行频率，周期任务里面会关闭过期客户端、删除过期key的一系列任务，可以用INFO查看周期任务</li><li>每次删除的数量: 每次检查的数量是写死在代码里面的，每次20个，但是会有一个循环会检查过期key数量占比，大于25%，则再抽查20个来检查，同时Redis为了保证定期不会出现循环过度，导致线程卡死，为此增加了了定期删除循环流程的时间上限，默认不超过25ms</li></ul></li></ul><p><strong>Redis过期键采用的是惰性删除+定期删除二者结合的方式进行删除</strong></p><div class=list-group-key>2025</div><div><div class=list-group-heading><a href=/notes/database/redis/datatypes/zset/>Redis - ZSet</a></div><div class="list-group-summary content-font">Redis ZSet 是一个关联分数排序的唯一字符串集合. 当多个字符串具有相同分数时，字符串会按照字典顺序排列。</div></div><div><div class=list-group-heading><a href=/notes/database/redis/datatypes/string/>Redis - String</a></div><div class="list-group-summary content-font">Redis String 类型，存储字节，包括文本，序列化对象和二进制数组，因此 String是Redis最基本的数据结构. 通常用于缓存，而且Redis支持其他功能，允许实现计数器并执行按位运算.</div></div><div><div class=list-group-heading><a href=/notes/database/redis/datatypes/stream/>Redis - Stream</a></div><div class="list-group-summary content-font">Redis Stream是一种数据结构，其作用类似于仅追加日志，但也实现了多种操作克服典型的仅追加日志的限制. 包括O(1)时间内的随机访问和复杂的消费策略</div></div><div><div class=list-group-heading><a href=/notes/database/redis/datatypes/set/>Redis - Set</a></div><div class="list-group-summary content-font">Redis Set是一个唯一字符串的集合</div></div><div><div class=list-group-heading><a href=/notes/database/redis/datatypes/list/>Redis - List</a></div><div class="list-group-summary content-font">Redis List经常用于:</div></div><div><div class=list-group-heading><a href=/notes/database/redis/datatypes/hash/>Redis - Hash</a></div><div class="list-group-summary content-font">Redis Hash 是结构化为字段值(field)->值(value)集合的记录类型. 可以使用Hash来表示基础对象并存储计数器分组.</div></div><div class=section-item><div class=list-group-heading>>
<a class=a-list-head href=/notes/database/redis/datatypes/encoding/>Redis - Encoding</a></div><div class="list-group-summary content-font">Redis 数据类型底层编码.</div></div></main><footer id=main-footer><div class=footer><a href=#>回到顶部 ↑</a><div class=footer-copyright><div>© 2025 Chen-Hang</div><div>powered by <a href=https://github.com/math-queiroz/rusty-typewriter target=_blank>Rusty Typewriter</a> theme for <a href=https://gohugo.io/ target=_blank>Hugo</a></div></div></div></footer></div><aside id=side-pane><form onsubmit=searchBarSubmit(event)><div class=search-bar><svg style="min-width:16px" width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15.7955 15.8111 21 21M18 10.5c0 4.1421-3.3579 7.5-7.5 7.5C6.35786 18 3 14.6421 3 10.5 3 6.35786 6.35786 3 10.5 3 14.6421 3 18 6.35786 18 10.5z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
<input id=searchInput type=text autocomplete=off placeholder="搜索. . ."></div></form><script>function searchBarSubmit(e){e.preventDefault();const t=`https://chhz0.github.io/search/?q=${encodeURIComponent(e.target.elements.searchInput.value)}`;window.location.href=t}</script></aside></div></div></body></html>