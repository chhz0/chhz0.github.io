<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Makefile-learn | ch.hugo</title>
<link rel=icon href=favicon.svg sizes=any type=image/svg+xml><meta property="og:url" content="https://chhz0.github.io/blogs/2025/0704.makefile-learn/"><meta property="og:site_name" content="ch.hugo"><meta property="og:title" content="Makefile-learn"><meta property="og:description" content='Makefile 快速入门
概述 makefile 关系到了整个工程的编译规则，makefile 定义了一系列的规则来指定，哪些文件需要先编译，哪些文件后需要编译，哪些文件需要重新编译，甚者进行更复杂的功能操作，makefile 像 shell脚本一样，其中也可以执行操作系统的命令。
makefile带来的好处是-“自动化编译”，一旦写好，一个make命令，整个工程完全自动编译，极大提高了软件开发的效率。make是一个命令工具，是一个解释makefile中指令的命令工具。
Makefile结构说明 makefile 主要包含了五个东西：变量定义，显示规则，隐晦规则，文件标示和注释。
变量定义。在makefile中我们需要定义一系列的变量，一般是字符串，当makefile被执行时，其中的变量都会被扩展到相应的引用位置上。 显示规则。说明了如何生成一个或者多个目标文件，由makefile的书写者明显指出，要生成的文件，文件的依赖文件，生成的文件。【可类似shell脚本】 隐晦规则。由于make有自动推导功能，使用隐晦的规则可以让我们比较粗糙地简略书写makefile 文件指示。其中包括了三个部分。\ 注释。Makefile中只有行注释，使用 # 字符 Makefile中的预定义变量 预定变量 说明 $* 不包含扩展名的目标文件名称 $+ 所有的依赖文件，以空格分开，并以出现的先后为序，可能包含重复的依赖文件 $< 第一个依赖文件的名称 $? 所有的依赖文件，以空格分开，这些依赖文件的修改日期比目标的创建日期晚 $@ 目标的完整名称 $^ 所有的依赖文件，以空格分开，不包含重复的依赖文件 $% 如果目标是归档成员，则该变量表示目标的归档成员名称 Go Makefile 使用makefile快速编译Go web程序，期望：
高级、简单的命令。比如：compile start stop watch 等等 管理具体项目环境的变量，它应该包含 .env 文件 开发模式，修改时自动编译 开发模式，修改时自动重启服务 开发模式，简洁地显示编译的错误信息 具体项目的GOPATH，可以在vendor目录维护依赖包 简化文件查看， 1. 环境变量 在makefile中 include为项目定义环境变量，第一行如下
include .env ^^^ (待补充…)
final.最终版本 include .env PROJECTNAME=$(shell basename "$(PWD)") # Go related variables. GOBASE=$(shell pwd) GOPATH="$(GOBASE)/vendor:$(GOBASE) GOBIN=$(GOBASE)/bin GOFILES=$(wildcard *.go) # Redirect error output to a file, so we can show it in development mode. STDERR=/tmp/.$(PROJECTNAME)-stderr.txt # PID file will keep the process id of the server PID=/tmp/.$(PROJECTNAME).pid # Make is verbose in Linux. Make it silent. MAKEFLAGS += --silent ## install: Install missing dependencies. Runs `go get` internally. e.g; make install get=github.com/foo/bar install: go-get ## start: Start in development mode. Auto-starts when code changes. start: bash -c "trap &#39;make stop&#39; EXIT; $(MAKE) compile start-server watch run=&#39;make compile start-server&#39;" ## stop: Stop development mode. stop: stop-server start-server: stop-server @echo " > $(PROJECTNAME) is available at $(ADDR)" @-$(GOBIN)/$(PROJECTNAME) 2>&amp;1 & echo $$! > $(PID) @cat $(PID) | sed "/^/s/^/ \> PID: /" stop-server: @-touch $(PID) @-kill `cat $(PID)` 2> /dev/null || true @-rm $(PID) ## watch: Run given command when code changes. e.g; make watch run="echo &#39;hey&#39;" watch: @GOPATH=$(GOPATH) GOBIN=$(GOBIN) yolo -i . -e vendor -e bin -c "$(run)" restart-server: stop-server start-server ## compile: Compile the binary. compile: @-touch $(STDERR) @-rm $(STDERR) @-$(MAKE) -s go-compile 2> $(STDERR) @cat $(STDERR) | sed -e &#39;1s/.*/\nError:\n/&#39; | sed &#39;s/make\[.*/ /&#39; | sed "/^/s/^/ /" 1>&amp;2 ## exec: Run given command, wrapped with custom GOPATH. e.g; make exec run="go test ./..." exec: @GOPATH=$(GOPATH) GOBIN=$(GOBIN) $(run) ## clean: Clean build files. Runs `go clean` internally. clean: @(MAKEFILE) go-clean go-compile: go-clean go-get go-build go-build: @echo " > Building binary..." @GOPATH=$(GOPATH) GOBIN=$(GOBIN) go build -o $(GOBIN)/$(PROJECTNAME) $(GOFILES) go-generate: @echo " > Generating dependency files..." @GOPATH=$(GOPATH) GOBIN=$(GOBIN) go generate $(generate) go-get: @echo " > Checking if there is any missing dependencies..." @GOPATH=$(GOPATH) GOBIN=$(GOBIN) go get $(get) go-install: @GOPATH=$(GOPATH) GOBIN=$(GOBIN) go install $(GOFILES) go-clean: @echo " > Cleaning build cache" @GOPATH=$(GOPATH) GOBIN=$(GOBIN) go clean .PHONY: help all: help help: Makefile @echo @echo " Choose a command run in "$(PROJECTNAME)":" @echo @sed -n &#39;s/^##//p&#39; $< | column -t -s &#39;:&#39; | sed -e &#39;s/^/ /&#39; @echo 相关资料 (陈皓) 跟我一起写 Makefile（一）_haoel的博客-CSDN博客_makefile标签 Makefile由浅入深–教程、干货 - 知乎 (zhihu.com)'><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2025-07-04T15:10:00+08:00"><meta property="article:modified_time" content="2025-07-04T15:10:00+08:00"><meta property="article:tag" content="Makefile"><meta name=twitter:card content="summary"><meta name=twitter:title content="Makefile-learn"><meta name=twitter:description content='Makefile 快速入门
概述 makefile 关系到了整个工程的编译规则，makefile 定义了一系列的规则来指定，哪些文件需要先编译，哪些文件后需要编译，哪些文件需要重新编译，甚者进行更复杂的功能操作，makefile 像 shell脚本一样，其中也可以执行操作系统的命令。
makefile带来的好处是-“自动化编译”，一旦写好，一个make命令，整个工程完全自动编译，极大提高了软件开发的效率。make是一个命令工具，是一个解释makefile中指令的命令工具。
Makefile结构说明 makefile 主要包含了五个东西：变量定义，显示规则，隐晦规则，文件标示和注释。
变量定义。在makefile中我们需要定义一系列的变量，一般是字符串，当makefile被执行时，其中的变量都会被扩展到相应的引用位置上。 显示规则。说明了如何生成一个或者多个目标文件，由makefile的书写者明显指出，要生成的文件，文件的依赖文件，生成的文件。【可类似shell脚本】 隐晦规则。由于make有自动推导功能，使用隐晦的规则可以让我们比较粗糙地简略书写makefile 文件指示。其中包括了三个部分。\ 注释。Makefile中只有行注释，使用 # 字符 Makefile中的预定义变量 预定变量 说明 $* 不包含扩展名的目标文件名称 $+ 所有的依赖文件，以空格分开，并以出现的先后为序，可能包含重复的依赖文件 $< 第一个依赖文件的名称 $? 所有的依赖文件，以空格分开，这些依赖文件的修改日期比目标的创建日期晚 $@ 目标的完整名称 $^ 所有的依赖文件，以空格分开，不包含重复的依赖文件 $% 如果目标是归档成员，则该变量表示目标的归档成员名称 Go Makefile 使用makefile快速编译Go web程序，期望：
高级、简单的命令。比如：compile start stop watch 等等 管理具体项目环境的变量，它应该包含 .env 文件 开发模式，修改时自动编译 开发模式，修改时自动重启服务 开发模式，简洁地显示编译的错误信息 具体项目的GOPATH，可以在vendor目录维护依赖包 简化文件查看， 1. 环境变量 在makefile中 include为项目定义环境变量，第一行如下
include .env ^^^ (待补充…)
final.最终版本 include .env PROJECTNAME=$(shell basename "$(PWD)") # Go related variables. GOBASE=$(shell pwd) GOPATH="$(GOBASE)/vendor:$(GOBASE) GOBIN=$(GOBASE)/bin GOFILES=$(wildcard *.go) # Redirect error output to a file, so we can show it in development mode. STDERR=/tmp/.$(PROJECTNAME)-stderr.txt # PID file will keep the process id of the server PID=/tmp/.$(PROJECTNAME).pid # Make is verbose in Linux. Make it silent. MAKEFLAGS += --silent ## install: Install missing dependencies. Runs `go get` internally. e.g; make install get=github.com/foo/bar install: go-get ## start: Start in development mode. Auto-starts when code changes. start: bash -c "trap &#39;make stop&#39; EXIT; $(MAKE) compile start-server watch run=&#39;make compile start-server&#39;" ## stop: Stop development mode. stop: stop-server start-server: stop-server @echo " > $(PROJECTNAME) is available at $(ADDR)" @-$(GOBIN)/$(PROJECTNAME) 2>&amp;1 & echo $$! > $(PID) @cat $(PID) | sed "/^/s/^/ \> PID: /" stop-server: @-touch $(PID) @-kill `cat $(PID)` 2> /dev/null || true @-rm $(PID) ## watch: Run given command when code changes. e.g; make watch run="echo &#39;hey&#39;" watch: @GOPATH=$(GOPATH) GOBIN=$(GOBIN) yolo -i . -e vendor -e bin -c "$(run)" restart-server: stop-server start-server ## compile: Compile the binary. compile: @-touch $(STDERR) @-rm $(STDERR) @-$(MAKE) -s go-compile 2> $(STDERR) @cat $(STDERR) | sed -e &#39;1s/.*/\nError:\n/&#39; | sed &#39;s/make\[.*/ /&#39; | sed "/^/s/^/ /" 1>&amp;2 ## exec: Run given command, wrapped with custom GOPATH. e.g; make exec run="go test ./..." exec: @GOPATH=$(GOPATH) GOBIN=$(GOBIN) $(run) ## clean: Clean build files. Runs `go clean` internally. clean: @(MAKEFILE) go-clean go-compile: go-clean go-get go-build go-build: @echo " > Building binary..." @GOPATH=$(GOPATH) GOBIN=$(GOBIN) go build -o $(GOBIN)/$(PROJECTNAME) $(GOFILES) go-generate: @echo " > Generating dependency files..." @GOPATH=$(GOPATH) GOBIN=$(GOBIN) go generate $(generate) go-get: @echo " > Checking if there is any missing dependencies..." @GOPATH=$(GOPATH) GOBIN=$(GOBIN) go get $(get) go-install: @GOPATH=$(GOPATH) GOBIN=$(GOBIN) go install $(GOFILES) go-clean: @echo " > Cleaning build cache" @GOPATH=$(GOPATH) GOBIN=$(GOBIN) go clean .PHONY: help all: help help: Makefile @echo @echo " Choose a command run in "$(PROJECTNAME)":" @echo @sed -n &#39;s/^##//p&#39; $< | column -t -s &#39;:&#39; | sed -e &#39;s/^/ /&#39; @echo 相关资料 (陈皓) 跟我一起写 Makefile（一）_haoel的博客-CSDN博客_makefile标签 Makefile由浅入深–教程、干货 - 知乎 (zhihu.com)'><link rel=stylesheet href=/css/components.min.9d886688d3ae94cecf1b057e706bf74497fcd5cea352d433c34cda3b9425a8d4.css integrity="sha256-nYhmiNOulM7PGwV+cGv3RJf81c6jUtQzw0zaO5QlqNQ=" crossorigin=anonymous><link rel=stylesheet href=/css/main.min.17813e97a146cc70fc6064666a89082f1ef2f6213c7d3fade88402a86cf8aa3c.css integrity="sha256-F4E+l6FGzHD8YGRmaokILx7y9iE8fT+t6IQCqGz4qjw=" crossorigin=anonymous><link rel=stylesheet href=/css/root.min.1677bc99f2421f7cb9fc1d00b09addcc951fd9d4c785e22b20ed55c0602786fc.css integrity="sha256-Fne8mfJCH3y5/B0AsJrdzJUf2dTHheIrIO1VwGAnhvw=" crossorigin=anonymous><link rel=stylesheet href=/css/search.min.cb1ed1dad3ee872e229e9f1fc681bdbd20d923389f1fa6aaf89f9aee93af4fbf.css integrity="sha256-yx7R2tPuhy4inp8fxoG9vSDZIzifH6aq+J+a7pOvT78=" crossorigin=anonymous><link rel=stylesheet href=/css/bundle.min.4878d16c866148ae8cfd6f4f44052d25f2548b24ab4a9bc857279dc6d06df2b5.css integrity="sha256-SHjRbIZhSK6M/W9PRAUtJfJUiySrSpvIVyedxtBt8rU=" crossorigin=anonymous><script src=/js/bundle.995e4ec99401021e081ec256bee66154ef7f4e5136809432513b2e6d014b4b1d.js integrity="sha256-mV5OyZQBAh4IHsJWvuZhVO9/TlE2gJQyUTsubQFLSx0=" crossorigin=anonymous></script><script defer src=/js/search/flexsearch.compact.64594b125f7b78bdf4fa8316955922bbebb1cd6baef3f16654bfca20309f18f8.js integrity="sha256-ZFlLEl97eL30+oMWlVkiu+uxzWuu8/FmVL/KIDCfGPg="></script><script defer src=/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js integrity="sha256-HZgPhN8R8+t8jF8X9UHUmgYRYI3xed10+n8GIl61as4="></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet></head><body class=notransition><div id=container><header id=main-header><div role=navigation aria-label=Main><div class=nav-left><a href=https://chhz0.github.io/ style=color:inherit>ch.hugo</a></div><div class=nav-right><div style=position:absolute;width:0;height:0><div id=nav-dropdown-menu class=hidden href=#><div class=nav-item><a aria-current=true class=ancestor href=/blogs/>博客</a></div><div class=nav-item><a href=/notes/>笔记</a></div><div class=nav-item><a href=/about/>关于</a></div></div></div><a id=nav-dropdown-button href=#><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4 6H20M4 12H20M4 18H20" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></a><div id=nav-menu><div class=nav-item><a aria-current=true class=ancestor href=/blogs/>博客</a></div><div class=nav-item><a href=/notes/>笔记</a></div><div class=nav-item><a href=/about/>关于</a></div></div><a id=theme-switcher href=#><svg class="light-icon" viewBox="0 0 24 24" fill="none"><path d="M12 3V4m0 16v1M4 12H3M6.31412 6.31412 5.5 5.5m12.1859.81412L18.5 5.5M6.31412 17.69 5.5 18.5001M17.6859 17.69 18.5 18.5001M21 12H20m-4 0c0 2.2091-1.7909 4-4 4-2.20914.0-4-1.7909-4-4 0-2.20914 1.79086-4 4-4 2.2091.0 4 1.79086 4 4z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
<svg class="dark-icon" viewBox="0 0 24 24" fill="none"><path d="M3.32031 11.6835c0 4.9706 4.02944 9 8.99999 9 3.7872.0 7.028-2.3392 8.3565-5.6515C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834c-4.9706.0-8.99999-4.0294-8.99999-8.99998C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996 5.65605 4.66028 3.32031 7.89912 3.32031 11.6835z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
</a>|
<a id=theme-switcher href=https://github.com/chhz0 aria-label=GitHub><svg class="light-icon" width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#fff"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg><svg class="dark-icon" width="800" height="800" viewBox="0 0 20 20" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github [#142]</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000"><g id="icons" transform="translate(56.000000, 160.000000)"><path d="M94 7399C99.523 7399 104 7403.59 104 7409.253 104 7413.782 101.138 7417.624 97.167 7418.981 96.66 7419.082 96.48 7418.762 96.48 7418.489 96.48 7418.151 96.492 7417.047 96.492 7415.675 96.492 7414.719 96.172 7414.095 95.813 7413.777 98.04 7413.523 100.38 7412.656 100.38 7408.718 100.38 7407.598 99.992 7406.684 99.35 7405.966 99.454 7405.707 99.797 7404.664 99.252 7403.252 99.252 7403.252 98.414 7402.977 96.505 7404.303 95.706 7404.076 94.85 7403.962 94 7403.958 93.15 7403.962 92.295 7404.076 91.497 7404.303 89.586 7402.977 88.746 7403.252 88.746 7403.252 88.203 7404.664 88.546 7405.707 88.649 7405.966 88.01 7406.684 87.619 7407.598 87.619 7408.718 87.619 7412.646 89.954 7413.526 92.175 7413.785 91.889 7414.041 91.63 7414.493 91.54 7415.156 90.97 7415.418 89.522 7415.871 88.63 7414.304 88.63 7414.304 88.101 7413.319 87.097 7413.247 87.097 7413.247 86.122 7413.234 87.029 7413.87 87.029 7413.87 87.684 7414.185 88.139 7415.37 88.139 7415.37 88.726 7417.2 91.508 7416.58 91.513 7417.437 91.522 7418.245 91.522 7418.489 91.522 7418.76 91.338 7419.077 90.839 7418.982 86.865 7417.627 84 7413.783 84 7409.253 84 7403.59 88.478 7399 94 7399" id="github-[#142]"/></g></g></g></svg></a></div></div></header><div class="flex grow"><div id=main-pane><main id=main-content><div class=single-header><ol class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://chhz0.github.io/><span itemprop=name>Home</span>
</a><meta itemprop=position content='1'></li><span>&nbsp»&nbsp</span><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://chhz0.github.io/blogs/><span itemprop=name>Blog</span>
</a><meta itemprop=position content='2'></li><span>&nbsp»&nbsp</span></ol><h1>Makefile-learn</h1><time class=dim datetime=2025-07-04T15:10:00+08:00>July 4, 2025</time><div class=term-container><div class=tag><a href=https://chhz0.github.io/tags/makefile/>#Makefile</a></div></ol></div><section class=page-section><blockquote><p>Makefile 快速入门</p></blockquote><h2 id=概述>概述</h2><hr><p><code>makefile</code> 关系到了整个工程的编译规则，<code>makefile</code> 定义了一系列的规则来指定，哪些文件需要先编译，哪些文件后需要编译，哪些文件需要重新编译，甚者进行更复杂的功能操作，<code>makefile</code> 像 <code>shell</code>脚本一样，其中也可以执行操作系统的命令。</p><p><code>makefile</code>带来的好处是-“自动化编译”，一旦写好，一个<code>make</code>命令，整个工程完全自动编译，极大提高了软件开发的效率。<code>make</code>是一个命令工具，是一个解释<code>makefile</code>中指令的命令工具。</p><h2 id=makefile结构说明>Makefile结构说明</h2><hr><p><code>makefile</code> 主要包含了五个东西：变量定义，显示规则，隐晦规则，文件标示和注释。</p><ol><li>变量定义。在<code>makefile</code>中我们需要定义一系列的变量，一般是字符串，当<code>makefile</code>被执行时，其中的变量都会被扩展到相应的引用位置上。</li><li>显示规则。说明了如何生成一个或者多个目标文件，由<code>makefile</code>的书写者明显指出，要生成的文件，文件的依赖文件，生成的文件。【可类似<code>shell</code>脚本】</li><li>隐晦规则。由于make有自动推导功能，使用隐晦的规则可以让我们比较粗糙地简略书写<code>makefile</code></li><li>文件指示。其中包括了三个部分。\</li><li>注释。<code>Makefile</code>中只有行注释，使用 <code>#</code> 字符</li></ol><h2 id=makefile中的预定义变量>Makefile中的预定义变量</h2><hr><table><thead><tr><th>预定变量</th><th>说明</th></tr></thead><tbody><tr><td>$* 　</td><td>　不包含扩展名的目标文件名称</td></tr><tr><td>$+ 　</td><td>　所有的依赖文件，以空格分开，并以出现的先后为序，可能包含重复的依赖文件</td></tr><tr><td>$&lt; 　</td><td>　第一个依赖文件的名称</td></tr><tr><td>$? 　</td><td>　所有的依赖文件，以空格分开，这些依赖文件的修改日期比目标的创建日期晚</td></tr><tr><td>$@ 　</td><td>目标的完整名称</td></tr><tr><td>$^ 　</td><td>　所有的依赖文件，以空格分开，不包含重复的依赖文件</td></tr><tr><td>$%</td><td>如果目标是归档成员，则该变量表示目标的归档成员名称</td></tr></tbody></table><h2 id=go-makefile>Go Makefile</h2><hr><p>使用<code>makefile</code>快速编译Go web程序，期望：</p><ul><li>高级、简单的命令。比如：<code>compile</code> <code>start</code> <code>stop</code> <code>watch</code> 等等</li><li>管理具体项目环境的变量，它应该包含 <code>.env</code> 文件</li><li>开发模式，修改时自动编译</li><li>开发模式，修改时自动重启服务</li><li>开发模式，简洁地显示编译的错误信息</li><li>具体项目的GOPATH，可以在<code>vendor</code>目录维护依赖包</li><li>简化文件查看，</li></ul><h3 id=1-环境变量>1. 环境变量</h3><p>在<code>makefile</code>中 <code>include</code>为项目定义环境变量，第一行如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Plaintext data-lang=Plaintext><span style=display:flex><span>include .env
</span></span></code></pre></div><p>^^^
(待补充&mldr;)</p><h2 id=final最终版本>final.最终版本</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>include</span> <span style=color:#960050;background-color:#1e0010>.env</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PROJECTNAME<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>shell basename <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>PWD<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Go related variables.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>GOBASE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>shell pwd<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>GOPATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>GOBASE<span style=color:#66d9ef>)</span><span style=color:#e6db74>/vendor:</span><span style=color:#66d9ef>$(</span>GOBASE<span style=color:#66d9ef>)</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span>GOBIN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOBASE<span style=color:#66d9ef>)</span>/bin
</span></span><span style=display:flex><span>GOFILES<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>wildcard *.go<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Redirect error output to a file, so we can show it in development mode.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>STDERR<span style=color:#f92672>=</span>/tmp/.<span style=color:#66d9ef>$(</span>PROJECTNAME<span style=color:#66d9ef>)</span>-stderr.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># PID file will keep the process id of the server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>PID<span style=color:#f92672>=</span>/tmp/.<span style=color:#66d9ef>$(</span>PROJECTNAME<span style=color:#66d9ef>)</span>.pid
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Make is verbose in Linux. Make it silent.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>MAKEFLAGS <span style=color:#f92672>+=</span> --silent
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## install: Install missing dependencies. Runs `go get` internally. e.g; make install get=github.com/foo/bar
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>install</span><span style=color:#f92672>:</span> go-get
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## start: Start in development mode. Auto-starts when code changes.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>start</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    bash -c <span style=color:#e6db74>&#34;trap &#39;make stop&#39; EXIT; </span><span style=color:#66d9ef>$(</span>MAKE<span style=color:#66d9ef>)</span><span style=color:#e6db74> compile start-server watch run=&#39;make compile start-server&#39;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## stop: Stop development mode.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>stop</span><span style=color:#f92672>:</span> stop-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>start-server</span><span style=color:#f92672>:</span> stop-server
</span></span><span style=display:flex><span>    @echo <span style=color:#e6db74>&#34;  &gt;  </span><span style=color:#66d9ef>$(</span>PROJECTNAME<span style=color:#66d9ef>)</span><span style=color:#e6db74> is available at </span><span style=color:#66d9ef>$(</span>ADDR<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    @-<span style=color:#66d9ef>$(</span>GOBIN<span style=color:#66d9ef>)</span>/<span style=color:#66d9ef>$(</span>PROJECTNAME<span style=color:#66d9ef>)</span> 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp; echo $$! &gt; <span style=color:#66d9ef>$(</span>PID<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    @cat <span style=color:#66d9ef>$(</span>PID<span style=color:#66d9ef>)</span> | sed <span style=color:#e6db74>&#34;/^/s/^/  \&gt;  PID: /&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stop-server</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @-touch <span style=color:#66d9ef>$(</span>PID<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    @-kill <span style=color:#e6db74>`</span>cat <span style=color:#66d9ef>$(</span>PID<span style=color:#66d9ef>)</span><span style=color:#e6db74>`</span> 2&gt; /dev/null <span style=color:#f92672>||</span> true
</span></span><span style=display:flex><span>    @-rm <span style=color:#66d9ef>$(</span>PID<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## watch: Run given command when code changes. e.g; make watch run=&#34;echo &#39;hey&#39;&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>watch</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @GOPATH<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOPATH<span style=color:#66d9ef>)</span> GOBIN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOBIN<span style=color:#66d9ef>)</span> yolo -i . -e vendor -e bin -c <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>run<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>restart-server</span><span style=color:#f92672>:</span> stop-server start-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## compile: Compile the binary.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>compile</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @-touch <span style=color:#66d9ef>$(</span>STDERR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    @-rm <span style=color:#66d9ef>$(</span>STDERR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    @-<span style=color:#66d9ef>$(</span>MAKE<span style=color:#66d9ef>)</span> -s go-compile 2&gt; <span style=color:#66d9ef>$(</span>STDERR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    @cat <span style=color:#66d9ef>$(</span>STDERR<span style=color:#66d9ef>)</span> | sed -e <span style=color:#e6db74>&#39;1s/.*/\nError:\n/&#39;</span>  | sed <span style=color:#e6db74>&#39;s/make\[.*/ /&#39;</span> | sed <span style=color:#e6db74>&#34;/^/s/^/     /&#34;</span> 1&gt;&amp;<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## exec: Run given command, wrapped with custom GOPATH. e.g; make exec run=&#34;go test ./...&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>exec</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @GOPATH<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOPATH<span style=color:#66d9ef>)</span> GOBIN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOBIN<span style=color:#66d9ef>)</span> <span style=color:#66d9ef>$(</span>run<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## clean: Clean build files. Runs `go clean` internally.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>clean</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @<span style=color:#f92672>(</span>MAKEFILE<span style=color:#f92672>)</span> go-clean
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>go-compile</span><span style=color:#f92672>:</span> go-clean go-get go-build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>go-build</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @echo <span style=color:#e6db74>&#34;  &gt;  Building binary...&#34;</span>
</span></span><span style=display:flex><span>    @GOPATH<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOPATH<span style=color:#66d9ef>)</span> GOBIN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOBIN<span style=color:#66d9ef>)</span> go build -o <span style=color:#66d9ef>$(</span>GOBIN<span style=color:#66d9ef>)</span>/<span style=color:#66d9ef>$(</span>PROJECTNAME<span style=color:#66d9ef>)</span> <span style=color:#66d9ef>$(</span>GOFILES<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>go-generate</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @echo <span style=color:#e6db74>&#34;  &gt;  Generating dependency files...&#34;</span>
</span></span><span style=display:flex><span>    @GOPATH<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOPATH<span style=color:#66d9ef>)</span> GOBIN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOBIN<span style=color:#66d9ef>)</span> go generate <span style=color:#66d9ef>$(</span>generate<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>go-get</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @echo <span style=color:#e6db74>&#34;  &gt;  Checking if there is any missing dependencies...&#34;</span>
</span></span><span style=display:flex><span>    @GOPATH<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOPATH<span style=color:#66d9ef>)</span> GOBIN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOBIN<span style=color:#66d9ef>)</span> go get <span style=color:#66d9ef>$(</span>get<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>go-install</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @GOPATH<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOPATH<span style=color:#66d9ef>)</span> GOBIN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOBIN<span style=color:#66d9ef>)</span> go install <span style=color:#66d9ef>$(</span>GOFILES<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>go-clean</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @echo <span style=color:#e6db74>&#34;  &gt;  Cleaning build cache&#34;</span>
</span></span><span style=display:flex><span>    @GOPATH<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOPATH<span style=color:#66d9ef>)</span> GOBIN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>GOBIN<span style=color:#66d9ef>)</span> go clean
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>.PHONY</span><span style=color:#f92672>:</span> help
</span></span><span style=display:flex><span><span style=color:#a6e22e>all</span><span style=color:#f92672>:</span> help
</span></span><span style=display:flex><span><span style=color:#a6e22e>help</span><span style=color:#f92672>:</span> Makefile
</span></span><span style=display:flex><span>    @echo
</span></span><span style=display:flex><span>    @echo <span style=color:#e6db74>&#34; Choose a command run in &#34;</span><span style=color:#66d9ef>$(</span>PROJECTNAME<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;:&#34;</span>
</span></span><span style=display:flex><span>    @echo
</span></span><span style=display:flex><span>    @sed -n <span style=color:#e6db74>&#39;s/^##//p&#39;</span> $&lt; | column -t -s <span style=color:#e6db74>&#39;:&#39;</span> |  sed -e <span style=color:#e6db74>&#39;s/^/ /&#39;</span>
</span></span><span style=display:flex><span>    @echo
</span></span></code></pre></div><h2 id=相关资料>相关资料</h2><ul><li><a href=https://blog.csdn.net/haoel/article/details/2886>(陈皓) 跟我一起写 Makefile（一）_haoel的博客-CSDN博客_makefile标签</a></li><li><a href=https://zhuanlan.zhihu.com/p/47390641>Makefile由浅入深&ndash;教程、干货 - 知乎 (zhihu.com)</a></li></ul></section></main><footer id=main-footer><div class=footer><a href=#>回到顶部 ↑</a><div class=footer-copyright><div>© 2025 Chen-Hang</div><div>powered by <a href=https://github.com/math-queiroz/rusty-typewriter target=_blank>Rusty Typewriter</a> theme for <a href=https://gohugo.io/ target=_blank>Hugo</a></div></div></div></footer></div><aside id=side-pane class=side-sticky><div class=side-details><span>1102 字数</span>
<span>4 - 6 阅读时间</span><div class=side-details-taxonomy><small>categories:
<span class=details-taxonomy><a href=https://chhz0.github.io/categories/blog>Blog</a></span></small></div></div><h3>目录</h3><nav id=TableOfContents><ul><li><a href=#概述>概述</a></li><li><a href=#makefile结构说明>Makefile结构说明</a></li><li><a href=#makefile中的预定义变量>Makefile中的预定义变量</a></li><li><a href=#go-makefile>Go Makefile</a><ul><li><a href=#1-环境变量>1. 环境变量</a></li></ul></li><li><a href=#final最终版本>final.最终版本</a></li><li><a href=#相关资料>相关资料</a></li></ul></nav></aside></div></div></body></html>